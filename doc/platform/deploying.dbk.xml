<?xml version="1.0" encoding="utf-8"?>
<chapter xml:id="deploying" version="5.0.1" xmlns="http://docbook.org/ns/docbook"
	xmlns:xlink="http://www.w3.org/1999/xlink"
	xmlns:xml="http://www.w3.org/XML/1998/namespace"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:xi="http://www.w3.org/2001/XInclude"
	xsi:schemaLocation="http://docbook.org/ns/docbook https://docbook.org/xml/5.0.1/xsd/docbook.xsd
	http://www.w3.org/1999/xlink https://docbook.org/xml/5.0.1/xsd/xlink.xsd
	http://www.w3.org/XML/1998/namespace https://docbook.org/xml/5.0.1/xsd/xml.xsd">
	<title>Deploying</title>
	<section>
		<title>On CentOS or Red Hat Enterprise Linux</title>
		<section>
			<title>Clean installation</title>
			<para>
				<screen><![CDATA[# Make sure the environment is up-to-date
sudo yum clean all
sudo yum update
# Install standard third-parties
sudo yum install java-11-openjdk-headless
# Install the Argeo platform
sudo yum install argeo-node argeo-cms-e4-rap
# Required only for local access to the OSGi console (telnet localhost 2323):
sudo yum install telnet
# Reload systemd
sudo systemctl daemon-reload
# Start system
sudo systemctl start argeo
# Check log
sudo tail -200f /var/log/messages
# Make sure that the service is started after a server restart:
systemctl enable argeo
]]></screen>
			</para>
			<para>By default the system is accessible via HTTP port 8080:
				http://localhost:8080/cms/devops
			</para>
		</section>
		<section>
			<title>Update</title>
			<para>
				<screen><![CDATA[# Stop system
sudo systemctl stop argeo
# Make sure the environment is up-to-date
sudo yum clean all
sudo yum update
# Reload systemd
sudo systemctl daemon-reload
# Start system
sudo systemctl start argeo
# Check log
sudo tail -200f /var/log/messages
]]></screen>
			</para>
		</section>
		<section>
			<title>Firewall</title>
			<para>
				<screen><![CDATA[# Open port 8080
sudo firewall-cmd --add-port 8080/tcp
]]></screen>
			</para>
		</section>
		<section>
			<title>Apache reverse proxy</title>
			<para>
				<screen><![CDATA[<IfModule mod_ssl.c>
<VirtualHost <external IP address>:443>
  ServerName <external hostname>
  CustomLog logs/<external hostname>-access_log combined
  ErrorLog logs/<external hostname>-error_log

  ProxyPreserveHost On

  <Location / >
    ProxyPass http://<host on the local network>:8080/
    ProxyPassReverse http://<host on the local network>:8080/
  </Location>


SSLCertificateFile <path to certificates>/cert.pem
SSLCertificateKeyFile <path to certificates>/privkey.pem
SSLCertificateChainFile <path to certificates>/chain.pem
...

</VirtualHost>
</IfModule>
]]></screen>
			</para>
		</section>
	</section>
</chapter>